#!/bin/bash

cat <<EOF
{
    "pureftp_pwd_salts": {
EOF

if [[ -f "/etc/pure-ftpd/pure.passwd" ]]; then
	first_line=1
	while read -r line; do
	if (( first_line == 1)); then
		first_line=0
	else
		echo ","
	fi
	echo $line
	done <<< "$(cat /etc/pure-ftpd/pure.passwd | awk -F':' '{gsub(/\$[^$]+$/, "", $2); gsub(/^\$[^$]+\$/, "", $2); print "\""$1"\": \""$2"\""}')"
fi

echo '}}'
